using AIHappey.Core.Contracts;

namespace AIHappey.HeaderAuth;

public class HeaderApiKeyResolver(IHttpContextAccessor http) : IApiKeyResolver
{
    private static readonly Dictionary<string, string> ProviderHeaders =
        new(StringComparer.OrdinalIgnoreCase)
        {
            ["openai"] = "X-OpenAI-Key",
            ["mistral"] = "X-Mistral-Key",
            ["anthropic"] = "X-Anthropic-Key",
            ["google"] = "X-Google-Key",
            ["perplexity"] = "X-Perplexity-Key",
            ["cohere"] = "X-Cohere-Key",
            ["runway"] = "X-Runway-Key",
            ["aiml"] = "X-AIML-Key",
            ["jina"] = "X-Jina-Key",
            ["xai"] = "X-xAI-Key",
            ["scaleway"] = "X-Scaleway-Key",
            ["nscale"] = "X-Nscale-Key",
            ["cerebras"] = "X-Cerebras-Key",
            ["fireworks"] = "X-Fireworks-Key",
            ["sambanova"] = "X-SambaNova-Key",
            ["hyperbolic"] = "X-Hyperbolic-Key",
            ["zai"] = "X-Zai-Key",
            ["stabilityai"] = "X-StabilityAI-Key",
            ["groq"] = "X-Groq-Key",
            ["elevenlabs"] = "X-ElevenLabs-Key",
            ["novita"] = "X-Novita-Key",
            ["together"] = "X-Together-Key",
            ["telnyx"] = "X-Telnyx-Key",
            ["alibaba"] = "X-Alibaba-Key",
            ["nvidia"] = "X-NVIDIA-Key",
            ["nebius"] = "X-Nebius-Key",
            ["deepgram"] = "X-Deepgram-Key",
            ["runware"] = "X-Runware-Key",
            ["deepseek"] = "X-DeepSeek-Key",
            ["canopywave"] = "X-CanopyWave-Key",
            ["tinfoil"] = "X-Tinfoil-Key",
            ["deepinfra"] = "X-DeepInfra-Key",
            ["inferencenet"] = "X-Inferencenet-Key",
            ["cloudrift"] = "X-CloudRift-Key",
            ["async"] = "X-Async-Key",
            ["replicate"] = "X-Replicate-Key",
            ["baseten"] = "X-Baseten-Key",
            ["speechify"] = "X-Speechify-Key",
            ["contextualai"] = "X-ContextualAI-Key",
            ["sarvam"] = "X-Sarvam-Key",
            ["voyageai"] = "X-VoyageAI-Key",
            ["minimax"] = "X-MiniMax-Key",
            ["assemblyai"] = "X-AssemblyAI-Key",
            ["resembleai"] = "X-ResembleAI-Key",
            ["ttsreader"] = "X-TTSReader-Key",
            ["speechmatics"] = "X-Speechmatics-Key",
            ["hyperstack"] = "X-Hyperstack-Key",
            ["gladia"] = "X-Gladia-Key",
            ["verda"] = "X-Verda-Key",
            ["audixa"] = "X-Audixa-Key",
            ["freepik"] = "X-Freepik-Key",
            ["ai21"] = "X-AI21-Key",
            ["murfai"] = "X-MurfAI-Key",
            ["lingvanex"] = "X-Lingvanex-Key",
            ["googletranslate"] = "X-GoogleTranslate-Key",
            ["modernmt"] = "X-ModernMT-Key",
            ["lectoai"] = "X-LectoAI-Key",
            ["bria"] = "X-Bria-Key",
            ["friendli"] = "X-Friendli-Key",
            ["publicai"] = "X-PublicAI-Key",
            ["primeintellect"] = "X-PrimeIntellect-Key",
            ["ovhcloud"] = "X-OVHcloud-Key",
            ["gmicloud"] = "X-GMICloud-Key",
            ["byteplus"] = "X-BytePlus-Key",
            ["nlpcloud"] = "X-NLPCloud-Key",
            ["moonshot"] = "X-Moonshot-Key",
            ["upstage"] = "X-Upstage-Key",
            ["siliconflow"] = "X-SiliconFlow-Key",
            ["cirrascale"] = "X-Cirrascale-Key",
            ["klingai"] = "X-KlingAI-Key",
            ["euqai"] = "X-Euqai-Key",
            ["vidu"] = "X-Vidu-Key",
            ["reve"] = "X-Reve-Key",
            ["decart"] = "X-Decart-Key",
            ["json2video"] = "X-JSON2Video-Key",
            ["greenpt"] = "X-GreenPT-Key",
            ["relaxai"] = "X-RelaxAI-Key",
            ["regoloai"] = "X-RegoloAI-Key",
            ["arklabs"] = "X-ARKLabs-Key",
            ["ionos"] = "X-IONOS-Key",
            ["bergetai"] = "X-BergetAI-Key",
            ["opperai"] = "X-OpperAI-Key",
            ["gcore"] = "X-Gcore-Key",
            ["cortecs"] = "X-Cortecs-Key",
            ["inworld"] = "X-Inworld-Key",
            ["eurouter"] = "X-EUrouter-Key",
            ["requesty"] = "X-Requesty-Key",
            ["sudo"] = "X-Sudo-Key",
            ["portkey"] = "X-Portkey-Key",
            ["deepl"] = "X-DeepL-Key",
            ["cometapi"] = "X-CometAPI-Key",
            ["nextbit"] = "X-Nextbit-Key",
            ["deepbricks"] = "X-Deepbricks-Key",
            ["segmind"] = "X-Segmind-Key",
            ["rekaai"] = "X-RekaAI-Key",
            ["openrouter"] = "X-OpenRouter-Key",
            ["ai302"] = "X-302AI-Key",
            ["matterai"] = "X-MatterAI-Key",
            ["bytez"] = "X-Bytez-Key",
            ["sunoapi"] = "X-SunoAPI-Key",
            ["horayai"] = "X-HorayAI-Key",
            ["horayai"] = "X-Synexa-Key",
            ["recraft"] = "X-Recraft-Key",
            ["atlascloud"] = "X-AtlasCloud-Key",
            ["bineric"] = "X-Bineric-Key",
            ["digitalocean"] = "X-DigitalOcean-Key",
            ["gooseai"] = "X-GooseAI-Key",
            ["supa"] = "X-SUPA-Key",
            ["runpod"] = "X-Runpod-Key",
            ["meganova"] = "X-MegaNova-Key",
            ["llmgateway"] = "X-LLMGateway-Key",
            ["abliteration"] = "X-Abliteration-Key",
            ["amazonbedrock"] = "X-AmazonBedrock-Key",
            ["parasail"] = "X-Parasail-Key",
            ["mancerai"] = "X-MancerAI-Key",
            ["kilo"] = "X-Kilo-Key",
            ["tinker"] = "X-Tinker-Key",
            ["helicone"] = "X-Helicone-Key",
            ["nousresearch"] = "X-NousResearch-Key",
            ["paraloncloud"] = "X-ParalonCloud-Key",
            ["asione"] = "X-ASIOne-Key",
            ["apipie"] = "X-APIpie-Key",
            ["stepfun"] = "X-StepFun-Key",
            ["sealion"] = "X-SEALION-Key",
            ["tencenthunyuan"] = "X-TencentHunyuan-Key",
            ["deapi"] = "X-DeAPI-Key",
            ["infomaniak"] = "X-Infomaniak-Key",
            ["tavily"] = "X-Tavily-Key",
            ["opencode"] = "X-OpenCode-Key",
            ["haimaker"] = "X-Haimaker-Key",
            ["straico"] = "X-Straico-Key",
            ["monica"] = "X-Monica-Key",
            ["cambai"] = "X-CAMBAI-Key",
            ["morpheus"] = "X-Morpheus-Key",
            ["arceeai"] = "X-ArceeAI-Key",
            ["exa"] = "X-Exa-Key",
            ["featherless"] = "X-Featherless-Key",
            ["blackbox"] = "X-Blackbox-Key",
            ["ohmygpt"] = "X-OhMyGPT-Key",
            ["ideogram"] = "X-Ideogram-Key",
            ["pinecone"] = "X-Pinecone-Key",
            ["zyphra"] = "X-Zyphra-Key",
            ["picsart"] = "X-Picsart-Key",
            ["azerion"] = "X-Azerion-Key",
            ["blackforestlabs"] = "X-BlackForestLabs-Key",
            ["aionlabs"] = "X-AionLabs-Key",
            ["lumaai"] = "X-LumaAI-Key",
            ["truefoundry"] = "X-TrueFoundry-Key",
            ["databricks"] = "X-Databricks-Key",
            ["browseruse"] = "X-BrowserUse-Key",
            ["inferencesh"] = "X-Inferencesh-Key",
            ["crazyrouter"] = "X-Crazyrouter-Key",
            ["infraxa"] = "X-Infraxa-Key",
            ["inceptionlabs"] = "X-InceptionLabs-Key",
            ["daglo"] = "X-Daglo-Key",
            ["opeai"] = "X-OPEAI-Key",
            ["forefront"] = "X-Forefront-Key",
            ["aicc"] = "X-AICC-Key",
            ["yourvoic"] = "X-YourVoic-Key",
            ["fishaudio"] = "X-FishAudio-Key",
            ["lovo"] = "X-LOVO-Key",
            ["verbatik"] = "X-Verbatik-Key",
            ["cartesia"] = "X-Cartesia-Key",
            ["vapi"] = "X-Vapi-Key",
            ["smallestai"] = "X-SmallestAI-Key",
            ["orq"] = "X-Orq-Key",
            ["typecast"] = "X-Typecast-Key",
            ["unrealspeech"] = "X-UnrealSpeech-Key",
            ["kugu"] = "X-Kugu-Key",
            ["everypixellabs"] = "X-EverypixelLabs-Key",
            ["supertone"] = "X-Supertone-Key",
            ["uvoiceai"] = "X-UVoiceAI-Key",
            ["astica"] = "X-Astica-Key",
            ["heygen"] = "X-HeyGen-Key",
            ["ionet"] = "X-IOnet-Key",
            ["avian"] = "X-Avian-Key",
            ["llmapi"] = "X-LLMAPI-Key",
            ["llmlayer"] = "X-LLMLayer-Key",
            ["simplismart"] = "X-Simplismart-Key",
            ["chaingpt"] = "X-ChainGPT-Key",
            ["routeway"] = "X-Routeway-Key",
            ["cheapestinference"] = "X-CheapestInference-Key",
            ["tetrate"] = "X-Tetrate-Key",
            ["clod"] = "X-Clod-Key",
            ["github"] = "X-GitHub-Key",
            ["wai"] = "X-WAI-Key",
            ["venice"] = "X-Venice-Key",
            ["quiverai"] = "X-QuiverAI-Key",
            ["kissapi"] = "X-KissAPI-Key",
            ["zenmux"] = "X-ZenMux-Key",
            ["netmind"] = "X-NetMind-Key",
            ["apiyi"] = "X-APIyi-Key",
            ["widnai"] = "X-WidnAI-Key",
            ["thaura"] = "X-Thaura-Key",
            ["modal"] = "X-Modal-Key",
            ["apifree"] = "X-APIFree-Key",
            ["modelslab"] = "X-ModelsLab-Key",
            ["hicap"] = "X-Hicap-Key",
            ["prakasa"] = "X-Prakasa-Key",
            ["megallm"] = "X-MegaLLM-Key",
            ["infron"] = "X-Infron-Key",
            ["longcat"] = "X-LongCat-Key",
            ["aisa"] = "X-AIsa-Key",
            ["evolinkai"] = "X-EvoLinkAI-Key",
            ["zenlayer"] = "X-Zenlayer-Key",
            ["aihubmix"] = "X-AIHubMix-Key",
            ["uniapi"] = "X-UniAPI-Key",
            ["openaihk"] = "X-OpenAIHK-Key",
            ["apekey"] = "X-Apekey-Key",
            ["apertis"] = "X-Apertis-Key"
        };

    public static IReadOnlyDictionary<string, string> SupportedProviderHeaders => ProviderHeaders;

    public string? Resolve(string provider)
    {
        var ctx = http.HttpContext;
        if (ctx == null)
            return null;

        if (!ProviderHeaders.TryGetValue(provider, out var headerName))
            return null;

        // Try canonical name, then lowercase variant
        var headers = ctx.Request.Headers;
        return headers[headerName].FirstOrDefault()
            ?? headers[headerName.ToLowerInvariant()].FirstOrDefault();
    }
}
